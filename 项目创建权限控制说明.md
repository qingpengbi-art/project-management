# 项目创建权限控制说明

## 🎯 权限需求

根据业务需求，项目创建功能需要进行权限控制：

- **部门主管**: ✅ 可以创建新项目
- **普通成员**: ❌ 无法创建新项目

## 🔧 实现方案

### 📍 **修改位置**
- **文件**: `frontend/src/views/Projects.vue`
- **组件**: 新建项目按钮

### 💻 **代码实现**

#### ✅ **修改前**
```vue
<el-button type="primary" @click="showCreateDialog">
  <el-icon><Plus /></el-icon>
  新建项目
</el-button>
```

#### ✅ **修改后**
```vue
<el-button 
  v-if="authStore.hasPermission('create_project')"
  type="primary" 
  @click="showCreateDialog"
>
  <el-icon><Plus /></el-icon>
  新建项目
</el-button>
```

### 🔐 **权限配置**

#### 在 `frontend/src/stores/auth.js` 中已定义：

```javascript
const permissions = {
  // 项目权限
  'create_project': ['department_manager'],  // 只有部门主管可以创建项目
  'view_all_projects': ['department_manager'],
  'edit_all_projects': ['department_manager'],
  'delete_project': ['department_manager'],
  'view_own_projects': ['department_manager', 'member'],
  'edit_own_projects': ['department_manager', 'member'],
  // ... 其他权限
}
```

## 📋 **权限检查逻辑**

### 🔍 **hasPermission 方法**
```javascript
const hasPermission = (permission) => {
  if (!user.value || !user.value.role) return false
  
  // 部门主管拥有所有权限
  if (user.value.role === 'department_manager') return true
  
  // 根据权限映射检查
  const allowedRoles = permissions[permission] || []
  return allowedRoles.includes(user.value.role)
}
```

### 🎯 **权限验证流程**
1. **用户登录**: 获取用户角色信息
2. **权限检查**: 调用 `authStore.hasPermission('create_project')`
3. **UI控制**: 根据权限结果显示/隐藏按钮
4. **动态更新**: 用户角色变化时自动更新UI

## 👥 **用户角色说明**

### 🏢 **部门主管 (department_manager)**
- **权限**: 完整的项目管理权限
- **可见功能**:
  - ✅ 新建项目按钮
  - ✅ 编辑所有项目
  - ✅ 查看所有项目数据
  - ✅ 用户管理功能
  - ✅ 完整的Dashboard数据

### 👤 **普通成员 (member)**
- **权限**: 受限的项目参与权限
- **可见功能**:
  - ❌ 新建项目按钮（隐藏）
  - ✅ 查看参与的项目
  - ✅ 编辑参与的项目
  - ✅ 更新分配给自己的模块
  - ❌ 用户管理功能（隐藏）

## 🎨 **用户体验设计**

### ✅ **部门主管视图**
```
[筛选区域] [搜索框] [状态筛选] [人员筛选]
                    [新建项目] [刷新]  ← 显示新建按钮
```

### ✅ **普通成员视图**
```
[筛选区域] [搜索框] [状态筛选] 
                    [刷新]           ← 隐藏新建按钮
```

### 🔍 **视觉效果**
- **按钮隐藏**: 使用 `v-if` 完全隐藏，不占用空间
- **布局自适应**: 其他按钮自动调整位置
- **无权限提示**: 不显示禁用状态，避免困惑

## 🛡️ **安全特性**

### 🔐 **前端权限控制**
- **UI隐藏**: 无权限用户看不到创建按钮
- **路由保护**: 创建对话框组件受权限保护
- **动态检查**: 实时验证用户权限状态

### 🔒 **后端权限验证**
- **API保护**: 后端接口验证用户权限
- **双重验证**: 前后端同时进行权限检查
- **安全防护**: 防止绕过前端直接调用API

## 📊 **权限矩阵**

| 功能 | 部门主管 | 普通成员 | 说明 |
|------|----------|----------|------|
| **查看项目列表** | ✅ 全部 | ✅ 参与的 | 数据范围不同 |
| **创建新项目** | ✅ | ❌ | 本次实现重点 |
| **编辑项目** | ✅ 全部 | ✅ 参与的 | 角色限制 |
| **删除项目** | ✅ | ❌ | 仅主管权限 |
| **用户筛选** | ✅ | ❌ | 管理功能 |
| **模块更新** | ✅ 全部 | ✅ 分配的 | 范围限制 |

## 🔄 **测试验证**

### ✅ **部门主管测试**
1. 使用主管账号登录 (gaojimin)
2. 访问项目管理页面
3. 确认可以看到"新建项目"按钮
4. 点击按钮确认功能正常

### ✅ **普通成员测试**
1. 使用成员账号登录
2. 访问项目管理页面  
3. 确认"新建项目"按钮已隐藏
4. 其他功能正常使用

## 🎉 **应用效果**

现在访问 http://localhost:3000 的项目管理页面：

### 🏢 **部门主管用户**
- 可以看到完整的操作按钮组
- "新建项目"按钮正常显示和使用
- 拥有完整的项目管理权限

### 👤 **普通成员用户**  
- "新建项目"按钮完全隐藏
- 其他功能（刷新、筛选、查看）正常使用
- 界面简洁，避免混淆

## 🚀 **总结**

通过这次权限控制实现，我们达到了：

1. **✅ 精确权限控制**: 只有部门主管才能创建项目
2. **✅ 良好用户体验**: 按钮动态显示/隐藏
3. **✅ 安全性保障**: 前后端双重权限验证
4. **✅ 代码可维护**: 使用统一的权限检查机制

现在系统的权限控制更加严格和合理，符合实际的业务管理需求！🔐
