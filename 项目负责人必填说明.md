# 项目负责人必填功能说明

## 功能概述

已将创建项目对话框简化为只需选择项目负责人，删除了项目成员选择功能。项目负责人为必填项，创建项目时会自动将负责人添加为项目成员。

## 主要修改

### 1. 新增项目负责人字段
- **位置**: 创建项目对话框中，位于项目状态选择之后
- **类型**: 下拉选择框，支持搜索过滤
- **验证**: 必填项，不选择无法提交表单

### 2. 表单验证
```javascript
leader: [
  { required: true, message: '请选择项目负责人', trigger: 'change' }
]
```

### 3. 简化界面设计
- **删除项目成员选择**: 移除了手动添加项目成员的功能
- **自动成员管理**: 项目负责人会自动成为项目的唯一成员
- **简洁流程**: 创建项目流程更加简洁，减少用户操作步骤

### 4. 数据处理优化
- **自动添加**: 系统自动将选择的负责人添加到项目成员列表
- **数据完整性**: 确保提交的数据中包含负责人的完整信息（ID、姓名、职位、角色）

## 界面变化

### 创建项目对话框结构
1. **项目基本信息**
   - 项目名称（必填）
   - 项目描述
   - 优先级（必填）
   - 项目状态（必填）

2. **项目负责人**（新增必填字段）
   - 下拉选择框，显示所有可用用户
   - 格式：用户名 (职位)
   - 支持搜索过滤

3. **项目时间**
   - 开始日期
   - 结束日期

4. **项目成员**
   - 可添加额外的项目成员
   - 负责人会自动出现在成员列表中
   - 防止重复添加负责人

## 数据流程

### 创建项目时
1. 用户选择项目负责人（必填）
2. 可选择性添加其他项目成员
3. 提交时系统自动处理：
   - 检查负责人是否已在成员列表中
   - 如未在列表中，自动添加为"负责人"角色
   - 如已在列表中，确保其角色为"负责人"

### 提交数据结构
```javascript
{
  name: "项目名称",
  description: "项目描述", 
  leader: 1, // 负责人用户ID
  members: [
    {
      user_id: 1,
      name: "张三",
      position: "项目经理", 
      role: "leader"
    },
    {
      user_id: 2,
      name: "李四",
      position: "开发工程师",
      role: "member"
    }
  ],
  // ... 其他字段
}
```

## 错误处理

### 验证错误
- **未选择负责人**: "请选择项目负责人"
- **重复添加负责人**: "项目负责人已自动加入项目成员，无需重复添加"
- **重复添加成员**: "该成员已在项目中"

### 数据完整性
- 确保负责人信息完整（包含用户ID、姓名、职位、角色）
- 自动处理角色冲突（确保负责人角色正确）

## 兼容性

- 与现有项目编辑功能兼容
- 与后端API接口兼容
- 与项目成员管理功能兼容

## 修改文件

### 1. `frontend/src/components/CreateProjectDialog.vue`
- 添加项目负责人选择字段（必填）
- 删除项目成员手动添加功能
- 更新表单数据结构和验证规则  
- 修改提交逻辑以自动将负责人添加为项目成员

### 2. `frontend/src/components/EditProjectDialog.vue`
- 将项目成员选择替换为项目负责人选择
- 从现有项目成员中自动识别并设置负责人
- 保持与创建项目对话框一致的用户体验
- 简化表单结构，提高操作效率

## 使用说明

1. **创建项目**：
   - 填写项目基本信息
   - **必须选择项目负责人**
   - 系统自动将负责人设为项目成员
   - 提交创建

2. **编辑项目**：
   - 可以更改项目负责人
   - 系统自动从现有成员中识别当前负责人
   - 保存时更新项目成员信息

此功能确保每个项目都有明确的负责人，简化了项目创建和编辑流程，提高项目管理的规范性和责任分工的清晰度。
