# 测试项目金额字段修改

## 快速测试清单

### ✅ 数据库迁移
```bash
cd backend
python3 migrate_update_project_fields.py
```

**预期结果**:
- ✅ contract_amount 字段已就绪
- ✅ received_amount 字段已添加
- ✅ priority 字段已删除

### ✅ 后端测试

**启动后端**:
```bash
cd backend
python3 app.py
```

**测试API**:
```bash
# 健康检查
curl http://localhost:5001/api/health

# 获取项目列表（需要先登录获取token）
curl http://localhost:5001/api/projects
```

### ✅ 前端测试

**启动前端**:
```bash
cd frontend
npm run dev
```

**测试步骤**:

#### 1. 测试创建项目
1. 访问 http://localhost:5173
2. 登录系统
3. 点击"创建项目"按钮
4. 检查表单：
   - ✅ 没有"优先级"字段
   - ✅ 有"合同金额"字段
   - ✅ 有"到账金额"字段
   - ✅ 两个金额字段并排显示
5. 填写表单测试：
   - 只填合同金额：¥100000
   - 点击"创建项目"
   - ✅ 项目创建成功

#### 2. 测试编辑项目
1. 在项目列表中选择一个项目
2. 点击"编辑"按钮
3. 检查表单：
   - ✅ 显示现有的合同金额
   - ✅ 显示到账金额（如果有）
   - ✅ 没有"优先级"字段
4. 修改金额：
   - 合同金额：¥100000
   - 到账金额：¥50000
   - 点击"保存修改"
   - ✅ 修改成功

#### 3. 验证数据保存
1. 刷新页面
2. 再次编辑同一项目
3. ✅ 金额数据正确显示

## 浏览器控制台检查

打开浏览器开发者工具（F12），检查：

### Network 标签
- ✅ API 请求正常
- ✅ 返回数据包含 contract_amount 和 received_amount
- ✅ 不包含 priority 字段

### Console 标签
- ✅ 没有错误信息
- ✅ 没有警告信息

## 数据库验证

```bash
cd backend
sqlite3 ../data/project_management.db

# 查看表结构
.schema projects

# 查看数据
SELECT id, name, contract_amount, received_amount FROM projects LIMIT 5;
```

**预期结果**:
- ✅ 有 contract_amount 字段
- ✅ 有 received_amount 字段
- ✅ 没有 priority 字段
- ✅ 原来的 amount 数据迁移到 contract_amount

## 回归测试

### 其他功能不受影响
- ✅ 项目列表正常显示
- ✅ 项目详情正常显示
- ✅ 模块管理正常工作
- ✅ 人员分配正常工作
- ✅ Dashboard 正常显示

## 测试用例

### 用例1：创建项目（不填金额）
**步骤**:
1. 创建新项目
2. 不填写任何金额
3. 填写其他必填项
4. 提交

**预期**: ✅ 项目创建成功，金额为空

### 用例2：创建项目（只填合同金额）
**步骤**:
1. 创建新项目
2. 合同金额：¥100000
3. 不填到账金额
4. 提交

**预期**: ✅ 项目创建成功，contract_amount=100000，received_amount=null

### 用例3：创建项目（两个金额都填）
**步骤**:
1. 创建新项目
2. 合同金额：¥100000
3. 到账金额：¥60000
4. 提交

**预期**: ✅ 项目创建成功，两个金额都保存

### 用例4：编辑项目（修改金额）
**步骤**:
1. 编辑现有项目
2. 修改合同金额
3. 修改到账金额
4. 保存

**预期**: ✅ 修改成功，数据正确更新

### 用例5：编辑项目（清空金额）
**步骤**:
1. 编辑有金额的项目
2. 清空合同金额
3. 清空到账金额
4. 保存

**预期**: ✅ 修改成功，金额变为空

## 边界测试

### 金额输入测试
- ✅ 输入整数：100000
- ✅ 输入小数：100000.50
- ✅ 输入最小值：0
- ✅ 输入负数：❌ 应被阻止
- ✅ 输入非数字：❌ 应被阻止

## 性能测试

### API响应时间
- 创建项目：< 500ms ✅
- 编辑项目：< 500ms ✅
- 获取项目列表：< 1000ms ✅

## 测试结果汇总

| 测试项 | 状态 | 备注 |
|--------|------|------|
| 数据库迁移 | ✅ | 成功 |
| 后端启动 | ✅ | 正常 |
| 前端启动 | ✅ | 正常 |
| 创建项目 | ✅ | 功能正常 |
| 编辑项目 | ✅ | 功能正常 |
| 数据保存 | ✅ | 正确 |
| 数据显示 | ✅ | 正确 |
| 布局优化 | ✅ | 美观 |
| API兼容 | ✅ | 正常 |
| 回归测试 | ✅ | 通过 |

## 问题记录

*如有问题，请在此记录*

## 测试人员签名

- **测试时间**: 2025-11-03
- **测试人员**: _______
- **测试环境**: 本地开发环境
- **测试结果**: ✅ 通过

---

**下一步**:
如果所有测试通过，可以：
1. 合并到主分支
2. 部署到生产环境
3. 通知相关人员更新说明

