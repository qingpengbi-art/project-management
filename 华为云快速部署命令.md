# ðŸš€ åŽä¸ºäº‘å¿«é€Ÿéƒ¨ç½²å‘½ä»¤é›†

## ðŸ“‹ éƒ¨ç½²å‰å‡†å¤‡æ¸…å•

### âœ… æœåŠ¡å™¨è¦æ±‚
- [x] åŽä¸ºäº‘ECSæœåŠ¡å™¨å·²è´­ä¹°
- [x] Ubuntu 20.04 LTSç³»ç»Ÿ
- [x] 2æ ¸4Gé…ç½®ï¼ˆæœ€ä½Ž1æ ¸2Gä¹Ÿå¯ä»¥ï¼‰
- [x] å®‰å…¨ç»„å·²é…ç½®ï¼ˆå¼€æ”¾22, 80, 443, 5001ç«¯å£ï¼‰
- [x] å¼¹æ€§å…¬ç½‘IPå·²ç»‘å®š

### âœ… æœ¬åœ°å‡†å¤‡
- [x] é¡¹ç›®ä»£ç å·²å®Œå–„
- [x] æµ‹è¯•è´¦å·å¯æ­£å¸¸ä½¿ç”¨
- [x] æ•°æ®åº“æ•°æ®å®Œæ•´

---

## ðŸ”§ ä¸€é”®éƒ¨ç½²å‘½ä»¤

### ç¬¬ä¸€æ­¥ï¼šè¿žæŽ¥æœåŠ¡å™¨
```bash
# æ›¿æ¢ä¸ºæ‚¨çš„å®žé™…æœåŠ¡å™¨IP
ssh root@æ‚¨çš„æœåŠ¡å™¨IP
```

### ç¬¬äºŒæ­¥ï¼šç³»ç»Ÿåˆå§‹åŒ–
```bash
# æ›´æ–°ç³»ç»Ÿ
apt update && apt upgrade -y

# å®‰è£…åŸºç¡€å·¥å…·
apt install -y curl wget vim git htop ufw

# åˆ›å»ºåº”ç”¨ç”¨æˆ·
useradd -m -s /bin/bash idim
passwd idim  # è®¾ç½®å¯†ç : idim123456
usermod -aG sudo idim

# åˆ‡æ¢åˆ°åº”ç”¨ç”¨æˆ·
su - idim
```

### ç¬¬ä¸‰æ­¥ï¼šå®‰è£…è¿è¡ŒçŽ¯å¢ƒ
```bash
# å®‰è£…Python
sudo apt install -y python3 python3-pip python3-venv

# å®‰è£…Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# å®‰è£…Nginx
sudo apt install -y nginx sqlite3

# å¯åŠ¨æœåŠ¡
sudo systemctl start nginx
sudo systemctl enable nginx
```

### ç¬¬å››æ­¥ï¼šä¸Šä¼ é¡¹ç›®ä»£ç 
```bash
# æ–¹æ³•1ï¼šå¦‚æžœä»£ç åœ¨GitHubï¼ˆæŽ¨èï¼‰
cd /home/idim
git clone https://github.com/your-username/idim-project.git é¡¹ç›®æŽ¨èè¡¨è®¾è®¡

# æ–¹æ³•2ï¼šä»Žæœ¬åœ°ä¸Šä¼ ï¼ˆåœ¨æœ¬åœ°ç”µè„‘æ‰§è¡Œï¼‰
# scp -r "/Users/bizai/Desktop/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡" idim@æœåŠ¡å™¨IP:/home/idim/
```

### ç¬¬äº”æ­¥ï¼šä¸€é”®éƒ¨ç½²
```bash
# è¿›å…¥é¡¹ç›®ç›®å½•
cd /home/idim/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡

# ç»™éƒ¨ç½²è„šæœ¬æ‰§è¡Œæƒé™
chmod +x deploy.sh

# æ‰§è¡Œéƒ¨ç½²ï¼ˆè¿™ä¸ªè„šæœ¬ä¼šè‡ªåŠ¨å®Œæˆæ‰€æœ‰é…ç½®ï¼‰
./deploy.sh
```

---

## ðŸ› ï¸ æ‰‹åŠ¨éƒ¨ç½²æ­¥éª¤ï¼ˆå¦‚æžœä¸€é”®è„šæœ¬å¤±è´¥ï¼‰

### åŽç«¯éƒ¨ç½²
```bash
cd /home/idim/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡/backend

# åˆ›å»ºè™šæ‹ŸçŽ¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# åˆå§‹åŒ–æ•°æ®åº“
python3 -c "
from models.database import init_database
from app import app
with app.app_context():
    init_database(app)
print('æ•°æ®åº“åˆå§‹åŒ–å®Œæˆ')
"
```

### å‰ç«¯æž„å»º
```bash
cd /home/idim/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡/frontend

# å®‰è£…ä¾èµ–
npm install

# æž„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build

# è®¾ç½®æƒé™
sudo chown -R www-data:www-data dist/
```

### é…ç½®ç³»ç»ŸæœåŠ¡
```bash
# åˆ›å»ºåŽç«¯æœåŠ¡æ–‡ä»¶
sudo tee /etc/systemd/system/idim-backend.service > /dev/null <<EOF
[Unit]
Description=IDIM Backend Service
After=network.target

[Service]
Type=simple
User=idim
WorkingDirectory=/home/idim/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡/backend
Environment=PATH=/home/idim/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡/backend/venv/bin
ExecStart=/home/idim/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡/backend/venv/bin/python app.py
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
EOF

# å¯åŠ¨æœåŠ¡
sudo systemctl daemon-reload
sudo systemctl start idim-backend
sudo systemctl enable idim-backend
```

### é…ç½®Nginx
```bash
# åˆ›å»ºNginxé…ç½®
sudo tee /etc/nginx/sites-available/idim > /dev/null <<EOF
server {
    listen 80;
    server_name _;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /home/idim/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡/frontend/dist;
        try_files \$uri \$uri/ /index.html;
    }
    
    # åŽç«¯APIä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:5001/api/;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }
}
EOF

# å¯ç”¨é…ç½®
sudo ln -s /etc/nginx/sites-available/idim /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl restart nginx
```

### é…ç½®é˜²ç«å¢™
```bash
sudo ufw enable
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
```

---

## ðŸ§ª éƒ¨ç½²éªŒè¯

### æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥åŽç«¯æœåŠ¡
sudo systemctl status idim-backend

# æ£€æŸ¥Nginx
sudo systemctl status nginx

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep -E ':(80|5001)'
```

### æµ‹è¯•è®¿é—®
```bash
# æµ‹è¯•æœ¬åœ°è®¿é—®
curl -I http://localhost
curl http://localhost/api/projects

# èŽ·å–å¤–ç½‘IP
curl ifconfig.me
```

### æµè§ˆå™¨æµ‹è¯•
è®¿é—®ï¼š`http://æ‚¨çš„æœåŠ¡å™¨IPåœ°å€`

---

## ðŸ“± ç§»åŠ¨ç«¯è®¿é—®æµ‹è¯•

### å¾®ä¿¡/QQå†…ç½®æµè§ˆå™¨æµ‹è¯•
1. åœ¨å¾®ä¿¡ä¸­å‘é€æœåŠ¡å™¨IPåœ°å€
2. ç‚¹å‡»é“¾æŽ¥æ‰“å¼€
3. æµ‹è¯•ç™»å½•å’ŒåŸºæœ¬åŠŸèƒ½

### æ‰‹æœºæµè§ˆå™¨æµ‹è¯•
1. ä½¿ç”¨Safari/Chromeç­‰æµè§ˆå™¨
2. è¾“å…¥æœåŠ¡å™¨IPåœ°å€
3. æµ‹è¯•å“åº”å¼å¸ƒå±€

---

## ðŸ” æ•…éšœæŽ’é™¤

### å¸¸ç”¨è¯Šæ–­å‘½ä»¤
```bash
# æŸ¥çœ‹åŽç«¯æ—¥å¿—
sudo journalctl -u idim-backend -f

# æŸ¥çœ‹Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/nginx/access.log

# æŸ¥çœ‹ç³»ç»Ÿèµ„æº
htop

# æŸ¥çœ‹ç£ç›˜ç©ºé—´
df -h

# æŸ¥çœ‹ç«¯å£å ç”¨
netstat -tlnp
```

### å¸¸è§é—®é¢˜è§£å†³
```bash
# 502é”™è¯¯ - åŽç«¯æœåŠ¡æœªå¯åŠ¨
sudo systemctl start idim-backend

# 404é”™è¯¯ - å‰ç«¯æ–‡ä»¶æƒé™é—®é¢˜
sudo chown -R www-data:www-data /home/idim/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡/frontend/dist

# æ•°æ®åº“æƒé™é—®é¢˜
sudo chown idim:idim /home/idim/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡/backend/database.db

# é‡æ–°æž„å»ºå‰ç«¯
cd /home/idim/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡/frontend
npm run build
```

---

## ðŸ“Š æ€§èƒ½ä¼˜åŒ–ï¼ˆå¯é€‰ï¼‰

### å¯ç”¨GzipåŽ‹ç¼©
```bash
# ç¼–è¾‘Nginxé…ç½®
sudo vim /etc/nginx/nginx.conf

# å–æ¶ˆæ³¨é‡Šgzipç›¸å…³é…ç½®
# gzip on;
# gzip_vary on;
# gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
```

### é…ç½®SSLè¯ä¹¦ï¼ˆå¦‚æžœæœ‰åŸŸåï¼‰
```bash
# å®‰è£…Certbot
sudo apt install -y certbot python3-certbot-nginx

# ç”³è¯·è¯ä¹¦ï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„åŸŸåï¼‰
sudo certbot --nginx -d yourdomain.com

# è®¾ç½®è‡ªåŠ¨ç»­æœŸ
sudo crontab -e
# æ·»åŠ ï¼š0 12 * * * /usr/bin/certbot renew --quiet
```

---

## ðŸŽ¯ éƒ¨ç½²å®Œæˆæ£€æŸ¥æ¸…å•

- [ ] æœåŠ¡å™¨å¯ä»¥é€šè¿‡IPåœ°å€è®¿é—®
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] é¡¹ç›®ç®¡ç†åŠŸèƒ½æ­£å¸¸
- [ ] äººå‘˜ç®¡ç†åŠŸèƒ½æ­£å¸¸ï¼ˆç®¡ç†å‘˜è´¦å·ï¼‰
- [ ] æ¨¡å—è¿›åº¦æ›´æ–°åŠŸèƒ½æ­£å¸¸
- [ ] ç§»åŠ¨ç«¯è®¿é—®æ­£å¸¸
- [ ] æ‰€æœ‰æµ‹è¯•è´¦å·éƒ½èƒ½æ­£å¸¸ç™»å½•
- [ ] æ•°æ®æŒä¹…åŒ–æ­£å¸¸ï¼ˆé‡å¯åŽæ•°æ®ä¸ä¸¢å¤±ï¼‰

---

## ðŸ“ž éƒ¨ç½²æ”¯æŒ

### å¦‚æžœé‡åˆ°é—®é¢˜ï¼š
1. **æŸ¥çœ‹è¯¦ç»†æŒ‡å—**: `/Users/bizai/Desktop/é¡¹ç›®æŽ¨èè¡¨è®¾è®¡/åŽä¸ºäº‘éƒ¨ç½²å®Œæ•´æŒ‡å—.md`
2. **æ£€æŸ¥æœåŠ¡çŠ¶æ€**: ä½¿ç”¨ä¸Šè¿°è¯Šæ–­å‘½ä»¤
3. **æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶**: é‡ç‚¹å…³æ³¨é”™è¯¯ä¿¡æ¯
4. **é‡æ–°æ‰§è¡Œéƒ¨ç½²**: `./deploy.sh`

### åŽä¸ºäº‘æŠ€æœ¯æ”¯æŒï¼š
- æŽ§åˆ¶å°å·¥å•ç³»ç»Ÿ
- ç”µè¯æŠ€æœ¯æ”¯æŒ
- åœ¨çº¿å®¢æœå’¨è¯¢

---

**ðŸŒŸ é¢„ç¥éƒ¨ç½²æˆåŠŸï¼éƒ¨ç½²å®ŒæˆåŽï¼Œæ‚¨çš„IDIMé¡¹ç›®ç®¡ç†ç³»ç»Ÿå°†å¯ä»¥è¢«å…¨ä¸–ç•Œè®¿é—®ï¼**
