# 🚀 华为云快速部署命令集

## 📋 部署前准备清单

### ✅ 服务器要求
- [x] 华为云ECS服务器已购买
- [x] Ubuntu 20.04 LTS系统
- [x] 2核4G配置（最低1核2G也可以）
- [x] 安全组已配置（开放22, 80, 443, 5001端口）
- [x] 弹性公网IP已绑定

### ✅ 本地准备
- [x] 项目代码已完善
- [x] 测试账号可正常使用
- [x] 数据库数据完整

---

## 🔧 一键部署命令

### 第一步：连接服务器
```bash
# 替换为您的实际服务器IP
ssh root@您的服务器IP
```

### 第二步：系统初始化
```bash
# 更新系统
apt update && apt upgrade -y

# 安装基础工具
apt install -y curl wget vim git htop ufw

# 创建应用用户
useradd -m -s /bin/bash idim
passwd idim  # 设置密码: idim123456
usermod -aG sudo idim

# 切换到应用用户
su - idim
```

### 第三步：安装运行环境
```bash
# 安装Python
sudo apt install -y python3 python3-pip python3-venv

# 安装Node.js
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# 安装Nginx
sudo apt install -y nginx sqlite3

# 启动服务
sudo systemctl start nginx
sudo systemctl enable nginx
```

### 第四步：上传项目代码
```bash
# 方法1：如果代码在GitHub（推荐）
cd /home/idim
git clone https://github.com/your-username/idim-project.git 项目推荐表设计

# 方法2：从本地上传（在本地电脑执行）
# scp -r "/Users/bizai/Desktop/项目推荐表设计" idim@服务器IP:/home/idim/
```

### 第五步：一键部署
```bash
# 进入项目目录
cd /home/idim/项目推荐表设计

# 给部署脚本执行权限
chmod +x deploy.sh

# 执行部署（这个脚本会自动完成所有配置）
./deploy.sh
```

---

## 🛠️ 手动部署步骤（如果一键脚本失败）

### 后端部署
```bash
cd /home/idim/项目推荐表设计/backend

# 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 初始化数据库
python3 -c "
from models.database import init_database
from app import app
with app.app_context():
    init_database(app)
print('数据库初始化完成')
"
```

### 前端构建
```bash
cd /home/idim/项目推荐表设计/frontend

# 安装依赖
npm install

# 构建生产版本
npm run build

# 设置权限
sudo chown -R www-data:www-data dist/
```

### 配置系统服务
```bash
# 创建后端服务文件
sudo tee /etc/systemd/system/idim-backend.service > /dev/null <<EOF
[Unit]
Description=IDIM Backend Service
After=network.target

[Service]
Type=simple
User=idim
WorkingDirectory=/home/idim/项目推荐表设计/backend
Environment=PATH=/home/idim/项目推荐表设计/backend/venv/bin
ExecStart=/home/idim/项目推荐表设计/backend/venv/bin/python app.py
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
EOF

# 启动服务
sudo systemctl daemon-reload
sudo systemctl start idim-backend
sudo systemctl enable idim-backend
```

### 配置Nginx
```bash
# 创建Nginx配置
sudo tee /etc/nginx/sites-available/idim > /dev/null <<EOF
server {
    listen 80;
    server_name _;
    
    # 前端静态文件
    location / {
        root /home/idim/项目推荐表设计/frontend/dist;
        try_files \$uri \$uri/ /index.html;
    }
    
    # 后端API代理
    location /api/ {
        proxy_pass http://127.0.0.1:5001/api/;
        proxy_set_header Host \$host;
        proxy_set_header X-Real-IP \$remote_addr;
        proxy_set_header X-Forwarded-For \$proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto \$scheme;
    }
}
EOF

# 启用配置
sudo ln -s /etc/nginx/sites-available/idim /etc/nginx/sites-enabled/
sudo rm -f /etc/nginx/sites-enabled/default
sudo nginx -t
sudo systemctl restart nginx
```

### 配置防火墙
```bash
sudo ufw enable
sudo ufw allow 22
sudo ufw allow 80
sudo ufw allow 443
```

---

## 🧪 部署验证

### 检查服务状态
```bash
# 检查后端服务
sudo systemctl status idim-backend

# 检查Nginx
sudo systemctl status nginx

# 检查端口监听
netstat -tlnp | grep -E ':(80|5001)'
```

### 测试访问
```bash
# 测试本地访问
curl -I http://localhost
curl http://localhost/api/projects

# 获取外网IP
curl ifconfig.me
```

### 浏览器测试
访问：`http://您的服务器IP地址`

---

## 📱 移动端访问测试

### 微信/QQ内置浏览器测试
1. 在微信中发送服务器IP地址
2. 点击链接打开
3. 测试登录和基本功能

### 手机浏览器测试
1. 使用Safari/Chrome等浏览器
2. 输入服务器IP地址
3. 测试响应式布局

---

## 🔍 故障排除

### 常用诊断命令
```bash
# 查看后端日志
sudo journalctl -u idim-backend -f

# 查看Nginx日志
sudo tail -f /var/log/nginx/error.log
sudo tail -f /var/log/nginx/access.log

# 查看系统资源
htop

# 查看磁盘空间
df -h

# 查看端口占用
netstat -tlnp
```

### 常见问题解决
```bash
# 502错误 - 后端服务未启动
sudo systemctl start idim-backend

# 404错误 - 前端文件权限问题
sudo chown -R www-data:www-data /home/idim/项目推荐表设计/frontend/dist

# 数据库权限问题
sudo chown idim:idim /home/idim/项目推荐表设计/backend/database.db

# 重新构建前端
cd /home/idim/项目推荐表设计/frontend
npm run build
```

---

## 📊 性能优化（可选）

### 启用Gzip压缩
```bash
# 编辑Nginx配置
sudo vim /etc/nginx/nginx.conf

# 取消注释gzip相关配置
# gzip on;
# gzip_vary on;
# gzip_types text/plain text/css application/json application/javascript text/xml application/xml;
```

### 配置SSL证书（如果有域名）
```bash
# 安装Certbot
sudo apt install -y certbot python3-certbot-nginx

# 申请证书（替换为您的域名）
sudo certbot --nginx -d yourdomain.com

# 设置自动续期
sudo crontab -e
# 添加：0 12 * * * /usr/bin/certbot renew --quiet
```

---

## 🎯 部署完成检查清单

- [ ] 服务器可以通过IP地址访问
- [ ] 登录功能正常
- [ ] 项目管理功能正常
- [ ] 人员管理功能正常（管理员账号）
- [ ] 模块进度更新功能正常
- [ ] 移动端访问正常
- [ ] 所有测试账号都能正常登录
- [ ] 数据持久化正常（重启后数据不丢失）

---

## 📞 部署支持

### 如果遇到问题：
1. **查看详细指南**: `/Users/bizai/Desktop/项目推荐表设计/华为云部署完整指南.md`
2. **检查服务状态**: 使用上述诊断命令
3. **查看日志文件**: 重点关注错误信息
4. **重新执行部署**: `./deploy.sh`

### 华为云技术支持：
- 控制台工单系统
- 电话技术支持
- 在线客服咨询

---

**🌟 预祝部署成功！部署完成后，您的IDIM项目管理系统将可以被全世界访问！**
