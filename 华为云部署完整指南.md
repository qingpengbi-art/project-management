# ğŸŒ IDIMé¡¹ç›®ç®¡ç†ç³»ç»Ÿ - åä¸ºäº‘éƒ¨ç½²å®Œæ•´æŒ‡å—

## ğŸ“‹ éƒ¨ç½²æ¦‚è§ˆ

### ğŸ¯ éƒ¨ç½²ç›®æ ‡
- âœ… å°†æ‚¨çš„é¡¹ç›®ç®¡ç†ç³»ç»Ÿéƒ¨ç½²åˆ°åä¸ºäº‘
- âœ… é…ç½®åŸŸåå’ŒSSLè¯ä¹¦ï¼ˆå¯é€‰ï¼‰
- âœ… å®ç°é«˜å¯ç”¨ã€å®‰å…¨çš„ç”Ÿäº§ç¯å¢ƒ
- âœ… æ”¯æŒå¤šç”¨æˆ·å¹¶å‘è®¿é—®

### ğŸ’° é¢„ä¼°æˆæœ¬
- **æœåŠ¡å™¨**: çº¦15-30å…ƒ/æœˆï¼ˆå­¦ç”Ÿä¼˜æƒ æ›´ä¾¿å®œï¼‰
- **åŸŸå**: çº¦30-60å…ƒ/å¹´ï¼ˆå¯é€‰ï¼‰
- **SSLè¯ä¹¦**: å…è´¹ï¼ˆLet's Encryptï¼‰
- **æ€»è®¡**: çº¦200-400å…ƒ/å¹´

---

## ğŸ›’ ç¬¬ä¸€æ­¥ï¼šè´­ä¹°åä¸ºäº‘æœåŠ¡å™¨

### 1.1 æ³¨å†Œåä¸ºäº‘è´¦å·
1. è®¿é—® [åä¸ºäº‘å®˜ç½‘](https://www.huaweicloud.com/)
2. ç‚¹å‡»"å…è´¹æ³¨å†Œ"
3. å®Œæˆå®åè®¤è¯ï¼ˆä¼ä¸šè®¤è¯æœ‰æ›´å¤šä¼˜æƒ ï¼‰

### 1.2 é€‰æ‹©äº‘æœåŠ¡å™¨ECS
1. è¿›å…¥æ§åˆ¶å° â†’ è®¡ç®— â†’ äº‘æœåŠ¡å™¨ECS
2. ç‚¹å‡»"è´­ä¹°äº‘æœåŠ¡å™¨"

### 1.3 æ¨èé…ç½®
```
è§„æ ¼é…ç½®ï¼š
- CPU: 2æ ¸
- å†…å­˜: 4GB
- ç³»ç»Ÿç›˜: 40GB SSD
- æ•°æ®ç›˜: å¯é€‰ï¼Œå»ºè®®20GBï¼ˆå­˜å‚¨æ•°æ®åº“ï¼‰

ç½‘ç»œé…ç½®ï¼š
- åŒºåŸŸ: é€‰æ‹©ç¦»ç”¨æˆ·æœ€è¿‘çš„åŒºåŸŸï¼ˆå¦‚åä¸œ-ä¸Šæµ·ï¼‰
- å¯ç”¨åŒº: éšæœºåˆ†é…
- ç½‘ç»œ: é»˜è®¤VPC
- å®‰å…¨ç»„: æ–°å»ºå®‰å…¨ç»„ï¼ˆåç»­é…ç½®ï¼‰
- å¼¹æ€§å…¬ç½‘IP: å¿…é€‰ï¼Œå¸¦å®½1-5Mbps

æ“ä½œç³»ç»Ÿï¼š
- é•œåƒç±»å‹: å…¬å…±é•œåƒ
- æ“ä½œç³»ç»Ÿ: Ubuntu 20.04 LTS
```

### 1.4 å®‰å…¨ç»„é…ç½®
åˆ›å»ºå®‰å…¨ç»„æ—¶ï¼Œå¼€æ”¾ä»¥ä¸‹ç«¯å£ï¼š
```
å…¥æ–¹å‘è§„åˆ™ï¼š
- SSH: 22ç«¯å£ï¼Œæºåœ°å€ 0.0.0.0/0
- HTTP: 80ç«¯å£ï¼Œæºåœ°å€ 0.0.0.0/0  
- HTTPS: 443ç«¯å£ï¼Œæºåœ°å€ 0.0.0.0/0
- è‡ªå®šä¹‰: 5001ç«¯å£ï¼Œæºåœ°å€ 0.0.0.0/0ï¼ˆåç«¯APIï¼‰
- è‡ªå®šä¹‰: 3001ç«¯å£ï¼Œæºåœ°å€ 0.0.0.0/0ï¼ˆå‰ç«¯æœåŠ¡ï¼‰
```

---

## ğŸ”§ ç¬¬äºŒæ­¥ï¼šæœåŠ¡å™¨åˆå§‹åŒ–

### 2.1 è¿æ¥æœåŠ¡å™¨
```bash
# ä½¿ç”¨SSHè¿æ¥ï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„å®é™…IPï¼‰
ssh root@æ‚¨çš„æœåŠ¡å™¨IPåœ°å€

# é¦–æ¬¡è¿æ¥éœ€è¦è¾“å…¥å¯†ç ï¼ˆè´­ä¹°æ—¶è®¾ç½®çš„å¯†ç ï¼‰
```

### 2.2 ç³»ç»Ÿæ›´æ–°
```bash
# æ›´æ–°è½¯ä»¶åŒ…åˆ—è¡¨
apt update

# å‡çº§ç³»ç»Ÿ
apt upgrade -y

# å®‰è£…åŸºæœ¬å·¥å…·
apt install -y curl wget vim git htop
```

### 2.3 åˆ›å»ºåº”ç”¨ç”¨æˆ·
```bash
# åˆ›å»ºä¸“ç”¨ç”¨æˆ·ï¼ˆå®‰å…¨æœ€ä½³å®è·µï¼‰
useradd -m -s /bin/bash idim
passwd idim  # è®¾ç½®å¯†ç 

# æ·»åŠ sudoæƒé™
usermod -aG sudo idim

# åˆ‡æ¢åˆ°åº”ç”¨ç”¨æˆ·
su - idim
```

---

## ğŸ ç¬¬ä¸‰æ­¥ï¼šå®‰è£…è¿è¡Œç¯å¢ƒ

### 3.1 å®‰è£…Pythonç¯å¢ƒ
```bash
# å®‰è£…Pythonå’Œpip
sudo apt install -y python3 python3-pip python3-venv

# éªŒè¯å®‰è£…
python3 --version
pip3 --version
```

### 3.2 å®‰è£…Node.jsç¯å¢ƒ
```bash
# å®‰è£…Node.jså’Œnpm
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# éªŒè¯å®‰è£…
node --version
npm --version
```

### 3.3 å®‰è£…æ•°æ®åº“
```bash
# å®‰è£…SQLiteï¼ˆè½»é‡çº§ï¼Œé€‚åˆä¸­å°å‹åº”ç”¨ï¼‰
sudo apt install -y sqlite3

# æˆ–å®‰è£…MySQLï¼ˆå¤§å‹åº”ç”¨æ¨èï¼‰
# sudo apt install -y mysql-server
# sudo mysql_secure_installation
```

### 3.4 å®‰è£…Nginx
```bash
# å®‰è£…Nginxåå‘ä»£ç†
sudo apt install -y nginx

# å¯åŠ¨å¹¶è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl start nginx
sudo systemctl enable nginx
```

---

## ğŸ“¦ ç¬¬å››æ­¥ï¼šéƒ¨ç½²åº”ç”¨

### 4.1 ä¸Šä¼ ä»£ç 
```bash
# æ–¹æ³•1ï¼šä½¿ç”¨git cloneï¼ˆæ¨èï¼‰
cd /home/idim
git clone https://github.com/your-repo/idim-project.git
cd idim-project

# æ–¹æ³•2ï¼šä½¿ç”¨scpä¸Šä¼ ï¼ˆä»æœ¬åœ°ï¼‰
# scp -r /Users/bizai/Desktop/é¡¹ç›®æ¨èè¡¨è®¾è®¡ idim@æœåŠ¡å™¨IP:/home/idim/
```

### 4.2 é…ç½®åç«¯ç¯å¢ƒ
```bash
# è¿›å…¥åç«¯ç›®å½•
cd /home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/backend

# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python3 -m venv venv
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt

# å¦‚æœæ²¡æœ‰requirements.txtï¼Œæ‰‹åŠ¨å®‰è£…
pip install flask flask-cors flask-sqlalchemy python-dotenv
```

### 4.3 é…ç½®å‰ç«¯
```bash
# è¿›å…¥å‰ç«¯ç›®å½•
cd /home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/frontend

# å®‰è£…ä¾èµ–
npm install

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
npm run build
```

### 4.4 ä¿®æ”¹é…ç½®æ–‡ä»¶
```bash
# ä¿®æ”¹åç«¯é…ç½®
cd /home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/backend
vim app.py

# å°†debug=Trueæ”¹ä¸ºdebug=False
# ç¡®ä¿host='0.0.0.0'
```

---

## ğŸ”„ ç¬¬äº”æ­¥ï¼šé…ç½®ç³»ç»ŸæœåŠ¡

### 5.1 åˆ›å»ºåç«¯æœåŠ¡
```bash
sudo vim /etc/systemd/system/idim-backend.service
```

å†™å…¥ä»¥ä¸‹å†…å®¹ï¼š
```ini
[Unit]
Description=IDIM Backend Service
After=network.target

[Service]
Type=simple
User=idim
WorkingDirectory=/home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/backend
Environment=PATH=/home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/backend/venv/bin
ExecStart=/home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/backend/venv/bin/python app.py
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

### 5.2 å¯åŠ¨åç«¯æœåŠ¡
```bash
# é‡æ–°åŠ è½½systemd
sudo systemctl daemon-reload

# å¯åŠ¨æœåŠ¡
sudo systemctl start idim-backend

# è®¾ç½®å¼€æœºè‡ªå¯
sudo systemctl enable idim-backend

# æ£€æŸ¥çŠ¶æ€
sudo systemctl status idim-backend
```

---

## ğŸŒ ç¬¬å…­æ­¥ï¼šé…ç½®Nginxåå‘ä»£ç†

### 6.1 åˆ›å»ºNginxé…ç½®
```bash
sudo vim /etc/nginx/sites-available/idim
```

å†™å…¥ä»¥ä¸‹é…ç½®ï¼š
```nginx
server {
    listen 80;
    server_name æ‚¨çš„åŸŸåæˆ–IPåœ°å€;
    
    # å‰ç«¯é™æ€æ–‡ä»¶
    location / {
        root /home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/frontend/dist;
        try_files $uri $uri/ /index.html;
        
        # ç¼“å­˜é™æ€èµ„æº
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # åç«¯APIä»£ç†
    location /api/ {
        proxy_pass http://127.0.0.1:5001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # æ”¯æŒWebSocketï¼ˆå¦‚æœéœ€è¦ï¼‰
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
    
    # å®‰å…¨å¤´
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
}
```

### 6.2 å¯ç”¨é…ç½®
```bash
# åˆ›å»ºè½¯é“¾æ¥
sudo ln -s /etc/nginx/sites-available/idim /etc/nginx/sites-enabled/

# åˆ é™¤é»˜è®¤é…ç½®
sudo rm /etc/nginx/sites-enabled/default

# æµ‹è¯•é…ç½®
sudo nginx -t

# é‡å¯Nginx
sudo systemctl restart nginx
```

---

## ğŸ”’ ç¬¬ä¸ƒæ­¥ï¼šé…ç½®SSLè¯ä¹¦ï¼ˆå¯é€‰ä½†æ¨èï¼‰

### 7.1 å®‰è£…Certbot
```bash
# å®‰è£…Certbot
sudo apt install -y certbot python3-certbot-nginx
```

### 7.2 ç”³è¯·SSLè¯ä¹¦
```bash
# ä¸ºåŸŸåç”³è¯·è¯ä¹¦ï¼ˆæ›¿æ¢ä¸ºæ‚¨çš„åŸŸåï¼‰
sudo certbot --nginx -d æ‚¨çš„åŸŸå.com

# å¦‚æœæ²¡æœ‰åŸŸåï¼Œå¯ä»¥è·³è¿‡æ­¤æ­¥éª¤
```

### 7.3 è®¾ç½®è‡ªåŠ¨ç»­æœŸ
```bash
# æµ‹è¯•è‡ªåŠ¨ç»­æœŸ
sudo certbot renew --dry-run

# æ·»åŠ å®šæ—¶ä»»åŠ¡
sudo crontab -e
# æ·»åŠ ä»¥ä¸‹è¡Œï¼š
# 0 12 * * * /usr/bin/certbot renew --quiet
```

---

## ğŸ”¥ ç¬¬å…«æ­¥ï¼šé…ç½®é˜²ç«å¢™

### 8.1 é…ç½®UFWé˜²ç«å¢™
```bash
# å¯ç”¨UFW
sudo ufw enable

# å…è®¸SSH
sudo ufw allow 22

# å…è®¸HTTPå’ŒHTTPS
sudo ufw allow 80
sudo ufw allow 443

# æ£€æŸ¥çŠ¶æ€
sudo ufw status
```

---

## ğŸ“Š ç¬¬ä¹æ­¥ï¼šç›‘æ§å’Œç»´æŠ¤

### 9.1 å®‰è£…ç›‘æ§å·¥å…·
```bash
# å®‰è£…htopï¼ˆç³»ç»Ÿç›‘æ§ï¼‰
sudo apt install -y htop

# å®‰è£…æ—¥å¿—æŸ¥çœ‹å·¥å…·
sudo apt install -y multitail
```

### 9.2 æŸ¥çœ‹æœåŠ¡çŠ¶æ€
```bash
# æŸ¥çœ‹åç«¯æœåŠ¡çŠ¶æ€
sudo systemctl status idim-backend

# æŸ¥çœ‹åç«¯æ—¥å¿—
sudo journalctl -u idim-backend -f

# æŸ¥çœ‹Nginxæ—¥å¿—
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### 9.3 æ•°æ®å¤‡ä»½
```bash
# åˆ›å»ºå¤‡ä»½è„šæœ¬
vim /home/idim/backup.sh
```

å†™å…¥å¤‡ä»½è„šæœ¬ï¼š
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/home/idim/backups"
PROJECT_DIR="/home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡"

# åˆ›å»ºå¤‡ä»½ç›®å½•
mkdir -p $BACKUP_DIR

# å¤‡ä»½æ•°æ®åº“
cp $PROJECT_DIR/backend/database.db $BACKUP_DIR/database_$DATE.db

# å¤‡ä»½ä»£ç ï¼ˆå¯é€‰ï¼‰
tar -czf $BACKUP_DIR/code_$DATE.tar.gz $PROJECT_DIR

# åˆ é™¤7å¤©å‰çš„å¤‡ä»½
find $BACKUP_DIR -name "*.db" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "Backup completed: $DATE"
```

è®¾ç½®å®šæ—¶å¤‡ä»½ï¼š
```bash
# æ·»åŠ æ‰§è¡Œæƒé™
chmod +x /home/idim/backup.sh

# è®¾ç½®å®šæ—¶ä»»åŠ¡ï¼ˆæ¯å¤©å‡Œæ™¨2ç‚¹å¤‡ä»½ï¼‰
crontab -e
# æ·»åŠ ï¼š0 2 * * * /home/idim/backup.sh
```

---

## ğŸ‰ ç¬¬åæ­¥ï¼šéªŒè¯éƒ¨ç½²

### 10.1 æ£€æŸ¥æœåŠ¡çŠ¶æ€
```bash
# æ£€æŸ¥æ‰€æœ‰æœåŠ¡
sudo systemctl status idim-backend nginx

# æ£€æŸ¥ç«¯å£ç›‘å¬
netstat -tlnp | grep -E ':(80|443|5001)'
```

### 10.2 æµ‹è¯•è®¿é—®
```bash
# æµ‹è¯•æœ¬åœ°è®¿é—®
curl -I http://localhost
curl -I http://localhost/api/projects

# ä»å¤–ç½‘æµ‹è¯•
curl -I http://æ‚¨çš„æœåŠ¡å™¨IP
```

### 10.3 æµè§ˆå™¨æµ‹è¯•
1. æ‰“å¼€æµè§ˆå™¨
2. è®¿é—®ï¼š`http://æ‚¨çš„æœåŠ¡å™¨IP` æˆ– `https://æ‚¨çš„åŸŸå.com`
3. ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•éªŒè¯åŠŸèƒ½

---

## ğŸš¨ å¸¸è§é—®é¢˜è§£å†³

### Q1: æœåŠ¡æ— æ³•å¯åŠ¨
```bash
# æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—
sudo journalctl -u idim-backend -n 50

# æ£€æŸ¥ç«¯å£å ç”¨
sudo netstat -tlnp | grep 5001

# æ£€æŸ¥æ–‡ä»¶æƒé™
ls -la /home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/backend/
```

### Q2: Nginx 502é”™è¯¯
```bash
# æ£€æŸ¥åç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ
sudo systemctl status idim-backend

# æ£€æŸ¥Nginxé…ç½®
sudo nginx -t

# æŸ¥çœ‹Nginxé”™è¯¯æ—¥å¿—
sudo tail -f /var/log/nginx/error.log
```

### Q3: æ•°æ®åº“è¿æ¥é—®é¢˜
```bash
# æ£€æŸ¥æ•°æ®åº“æ–‡ä»¶æƒé™
ls -la /home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/backend/database.db

# ä¿®æ”¹æƒé™
chown idim:idim /home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/backend/database.db
```

### Q4: é™æ€æ–‡ä»¶æ— æ³•è®¿é—®
```bash
# æ£€æŸ¥å‰ç«¯æ„å»º
cd /home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/frontend
npm run build

# æ£€æŸ¥æ–‡ä»¶æƒé™
sudo chown -R www-data:www-data /home/idim/é¡¹ç›®æ¨èè¡¨è®¾è®¡/frontend/dist
```

---

## ğŸ“ æŠ€æœ¯æ”¯æŒ

### åä¸ºäº‘æŠ€æœ¯æ”¯æŒ
- **å·¥å•ç³»ç»Ÿ**: åä¸ºäº‘æ§åˆ¶å° â†’ æœåŠ¡æ”¯æŒ â†’ æäº¤å·¥å•
- **ç”µè¯æ”¯æŒ**: 400-xxx-xxxxï¼ˆåä¸ºäº‘å®¢æœï¼‰
- **æ–‡æ¡£ä¸­å¿ƒ**: [åä¸ºäº‘å¸®åŠ©ä¸­å¿ƒ](https://support.huaweicloud.com/)

### åº”ç”¨æŠ€æœ¯æ”¯æŒ
- **ç³»ç»Ÿæ—¥å¿—**: `/var/log/` ç›®å½•ä¸‹çš„å„ç§æ—¥å¿—æ–‡ä»¶
- **åº”ç”¨æ—¥å¿—**: `sudo journalctl -u idim-backend`
- **Nginxæ—¥å¿—**: `/var/log/nginx/`

---

## ğŸ¯ éƒ¨ç½²åçš„ä¼˜åŒ–å»ºè®®

### æ€§èƒ½ä¼˜åŒ–
1. **å¯ç”¨Gzipå‹ç¼©**ï¼ˆNginxé…ç½®ï¼‰
2. **é…ç½®CDN**ï¼ˆåä¸ºäº‘CDNæœåŠ¡ï¼‰
3. **æ•°æ®åº“ä¼˜åŒ–**ï¼ˆç´¢å¼•ã€æŸ¥è¯¢ä¼˜åŒ–ï¼‰
4. **ç¼“å­˜ç­–ç•¥**ï¼ˆRedisç¼“å­˜ï¼‰

### å®‰å…¨åŠ å›º
1. **å®šæœŸæ›´æ–°ç³»ç»Ÿ**
2. **é…ç½®fail2ban**ï¼ˆé˜²æš´åŠ›ç ´è§£ï¼‰
3. **å®šæœŸå¤‡ä»½æ•°æ®**
4. **ç›‘æ§ç³»ç»Ÿèµ„æº**

### æ‰©å±•æ€§è€ƒè™‘
1. **è´Ÿè½½å‡è¡¡**ï¼ˆå¤šå°æœåŠ¡å™¨ï¼‰
2. **æ•°æ®åº“åˆ†ç¦»**ï¼ˆç‹¬ç«‹æ•°æ®åº“æœåŠ¡å™¨ï¼‰
3. **å®¹å™¨åŒ–éƒ¨ç½²**ï¼ˆDockerï¼‰
4. **è‡ªåŠ¨åŒ–éƒ¨ç½²**ï¼ˆCI/CDï¼‰

---

*éƒ¨ç½²å®Œæˆåï¼Œæ‚¨çš„IDIMé¡¹ç›®ç®¡ç†ç³»ç»Ÿå°†å¯ä»¥é€šè¿‡äº’è”ç½‘è®¿é—®ï¼Œæ”¯æŒå¤šç”¨æˆ·å¹¶å‘ä½¿ç”¨ï¼*

**ğŸŒŸ é¢„ç¥éƒ¨ç½²æˆåŠŸï¼**
