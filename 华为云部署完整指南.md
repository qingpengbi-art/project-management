# 🌐 IDIM项目管理系统 - 华为云部署完整指南

## 📋 部署概览

### 🎯 部署目标
- ✅ 将您的项目管理系统部署到华为云
- ✅ 配置域名和SSL证书（可选）
- ✅ 实现高可用、安全的生产环境
- ✅ 支持多用户并发访问

### 💰 预估成本
- **服务器**: 约15-30元/月（学生优惠更便宜）
- **域名**: 约30-60元/年（可选）
- **SSL证书**: 免费（Let's Encrypt）
- **总计**: 约200-400元/年

---

## 🛒 第一步：购买华为云服务器

### 1.1 注册华为云账号
1. 访问 [华为云官网](https://www.huaweicloud.com/)
2. 点击"免费注册"
3. 完成实名认证（企业认证有更多优惠）

### 1.2 选择云服务器ECS
1. 进入控制台 → 计算 → 云服务器ECS
2. 点击"购买云服务器"

### 1.3 推荐配置
```
规格配置：
- CPU: 2核
- 内存: 4GB
- 系统盘: 40GB SSD
- 数据盘: 可选，建议20GB（存储数据库）

网络配置：
- 区域: 选择离用户最近的区域（如华东-上海）
- 可用区: 随机分配
- 网络: 默认VPC
- 安全组: 新建安全组（后续配置）
- 弹性公网IP: 必选，带宽1-5Mbps

操作系统：
- 镜像类型: 公共镜像
- 操作系统: Ubuntu 20.04 LTS
```

### 1.4 安全组配置
创建安全组时，开放以下端口：
```
入方向规则：
- SSH: 22端口，源地址 0.0.0.0/0
- HTTP: 80端口，源地址 0.0.0.0/0  
- HTTPS: 443端口，源地址 0.0.0.0/0
- 自定义: 5001端口，源地址 0.0.0.0/0（后端API）
- 自定义: 3001端口，源地址 0.0.0.0/0（前端服务）
```

---

## 🔧 第二步：服务器初始化

### 2.1 连接服务器
```bash
# 使用SSH连接（替换为您的实际IP）
ssh root@您的服务器IP地址

# 首次连接需要输入密码（购买时设置的密码）
```

### 2.2 系统更新
```bash
# 更新软件包列表
apt update

# 升级系统
apt upgrade -y

# 安装基本工具
apt install -y curl wget vim git htop
```

### 2.3 创建应用用户
```bash
# 创建专用用户（安全最佳实践）
useradd -m -s /bin/bash idim
passwd idim  # 设置密码

# 添加sudo权限
usermod -aG sudo idim

# 切换到应用用户
su - idim
```

---

## 🐍 第三步：安装运行环境

### 3.1 安装Python环境
```bash
# 安装Python和pip
sudo apt install -y python3 python3-pip python3-venv

# 验证安装
python3 --version
pip3 --version
```

### 3.2 安装Node.js环境
```bash
# 安装Node.js和npm
curl -fsSL https://deb.nodesource.com/setup_18.x | sudo -E bash -
sudo apt install -y nodejs

# 验证安装
node --version
npm --version
```

### 3.3 安装数据库
```bash
# 安装SQLite（轻量级，适合中小型应用）
sudo apt install -y sqlite3

# 或安装MySQL（大型应用推荐）
# sudo apt install -y mysql-server
# sudo mysql_secure_installation
```

### 3.4 安装Nginx
```bash
# 安装Nginx反向代理
sudo apt install -y nginx

# 启动并设置开机自启
sudo systemctl start nginx
sudo systemctl enable nginx
```

---

## 📦 第四步：部署应用

### 4.1 上传代码
```bash
# 方法1：使用git clone（推荐）
cd /home/idim
git clone https://github.com/your-repo/idim-project.git
cd idim-project

# 方法2：使用scp上传（从本地）
# scp -r /Users/bizai/Desktop/项目推荐表设计 idim@服务器IP:/home/idim/
```

### 4.2 配置后端环境
```bash
# 进入后端目录
cd /home/idim/项目推荐表设计/backend

# 创建虚拟环境
python3 -m venv venv
source venv/bin/activate

# 安装依赖
pip install -r requirements.txt

# 如果没有requirements.txt，手动安装
pip install flask flask-cors flask-sqlalchemy python-dotenv
```

### 4.3 配置前端
```bash
# 进入前端目录
cd /home/idim/项目推荐表设计/frontend

# 安装依赖
npm install

# 构建生产版本
npm run build
```

### 4.4 修改配置文件
```bash
# 修改后端配置
cd /home/idim/项目推荐表设计/backend
vim app.py

# 将debug=True改为debug=False
# 确保host='0.0.0.0'
```

---

## 🔄 第五步：配置系统服务

### 5.1 创建后端服务
```bash
sudo vim /etc/systemd/system/idim-backend.service
```

写入以下内容：
```ini
[Unit]
Description=IDIM Backend Service
After=network.target

[Service]
Type=simple
User=idim
WorkingDirectory=/home/idim/项目推荐表设计/backend
Environment=PATH=/home/idim/项目推荐表设计/backend/venv/bin
ExecStart=/home/idim/项目推荐表设计/backend/venv/bin/python app.py
Restart=always
RestartSec=3

[Install]
WantedBy=multi-user.target
```

### 5.2 启动后端服务
```bash
# 重新加载systemd
sudo systemctl daemon-reload

# 启动服务
sudo systemctl start idim-backend

# 设置开机自启
sudo systemctl enable idim-backend

# 检查状态
sudo systemctl status idim-backend
```

---

## 🌐 第六步：配置Nginx反向代理

### 6.1 创建Nginx配置
```bash
sudo vim /etc/nginx/sites-available/idim
```

写入以下配置：
```nginx
server {
    listen 80;
    server_name 您的域名或IP地址;
    
    # 前端静态文件
    location / {
        root /home/idim/项目推荐表设计/frontend/dist;
        try_files $uri $uri/ /index.html;
        
        # 缓存静态资源
        location ~* \.(js|css|png|jpg|jpeg|gif|ico|svg)$ {
            expires 1y;
            add_header Cache-Control "public, immutable";
        }
    }
    
    # 后端API代理
    location /api/ {
        proxy_pass http://127.0.0.1:5001/api/;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
        
        # 支持WebSocket（如果需要）
        proxy_http_version 1.1;
        proxy_set_header Upgrade $http_upgrade;
        proxy_set_header Connection "upgrade";
    }
    
    # 安全头
    add_header X-Frame-Options "SAMEORIGIN" always;
    add_header X-XSS-Protection "1; mode=block" always;
    add_header X-Content-Type-Options "nosniff" always;
}
```

### 6.2 启用配置
```bash
# 创建软链接
sudo ln -s /etc/nginx/sites-available/idim /etc/nginx/sites-enabled/

# 删除默认配置
sudo rm /etc/nginx/sites-enabled/default

# 测试配置
sudo nginx -t

# 重启Nginx
sudo systemctl restart nginx
```

---

## 🔒 第七步：配置SSL证书（可选但推荐）

### 7.1 安装Certbot
```bash
# 安装Certbot
sudo apt install -y certbot python3-certbot-nginx
```

### 7.2 申请SSL证书
```bash
# 为域名申请证书（替换为您的域名）
sudo certbot --nginx -d 您的域名.com

# 如果没有域名，可以跳过此步骤
```

### 7.3 设置自动续期
```bash
# 测试自动续期
sudo certbot renew --dry-run

# 添加定时任务
sudo crontab -e
# 添加以下行：
# 0 12 * * * /usr/bin/certbot renew --quiet
```

---

## 🔥 第八步：配置防火墙

### 8.1 配置UFW防火墙
```bash
# 启用UFW
sudo ufw enable

# 允许SSH
sudo ufw allow 22

# 允许HTTP和HTTPS
sudo ufw allow 80
sudo ufw allow 443

# 检查状态
sudo ufw status
```

---

## 📊 第九步：监控和维护

### 9.1 安装监控工具
```bash
# 安装htop（系统监控）
sudo apt install -y htop

# 安装日志查看工具
sudo apt install -y multitail
```

### 9.2 查看服务状态
```bash
# 查看后端服务状态
sudo systemctl status idim-backend

# 查看后端日志
sudo journalctl -u idim-backend -f

# 查看Nginx日志
sudo tail -f /var/log/nginx/access.log
sudo tail -f /var/log/nginx/error.log
```

### 9.3 数据备份
```bash
# 创建备份脚本
vim /home/idim/backup.sh
```

写入备份脚本：
```bash
#!/bin/bash
DATE=$(date +%Y%m%d_%H%M%S)
BACKUP_DIR="/home/idim/backups"
PROJECT_DIR="/home/idim/项目推荐表设计"

# 创建备份目录
mkdir -p $BACKUP_DIR

# 备份数据库
cp $PROJECT_DIR/backend/database.db $BACKUP_DIR/database_$DATE.db

# 备份代码（可选）
tar -czf $BACKUP_DIR/code_$DATE.tar.gz $PROJECT_DIR

# 删除7天前的备份
find $BACKUP_DIR -name "*.db" -mtime +7 -delete
find $BACKUP_DIR -name "*.tar.gz" -mtime +7 -delete

echo "Backup completed: $DATE"
```

设置定时备份：
```bash
# 添加执行权限
chmod +x /home/idim/backup.sh

# 设置定时任务（每天凌晨2点备份）
crontab -e
# 添加：0 2 * * * /home/idim/backup.sh
```

---

## 🎉 第十步：验证部署

### 10.1 检查服务状态
```bash
# 检查所有服务
sudo systemctl status idim-backend nginx

# 检查端口监听
netstat -tlnp | grep -E ':(80|443|5001)'
```

### 10.2 测试访问
```bash
# 测试本地访问
curl -I http://localhost
curl -I http://localhost/api/projects

# 从外网测试
curl -I http://您的服务器IP
```

### 10.3 浏览器测试
1. 打开浏览器
2. 访问：`http://您的服务器IP` 或 `https://您的域名.com`
3. 使用测试账号登录验证功能

---

## 🚨 常见问题解决

### Q1: 服务无法启动
```bash
# 查看详细错误日志
sudo journalctl -u idim-backend -n 50

# 检查端口占用
sudo netstat -tlnp | grep 5001

# 检查文件权限
ls -la /home/idim/项目推荐表设计/backend/
```

### Q2: Nginx 502错误
```bash
# 检查后端服务是否运行
sudo systemctl status idim-backend

# 检查Nginx配置
sudo nginx -t

# 查看Nginx错误日志
sudo tail -f /var/log/nginx/error.log
```

### Q3: 数据库连接问题
```bash
# 检查数据库文件权限
ls -la /home/idim/项目推荐表设计/backend/database.db

# 修改权限
chown idim:idim /home/idim/项目推荐表设计/backend/database.db
```

### Q4: 静态文件无法访问
```bash
# 检查前端构建
cd /home/idim/项目推荐表设计/frontend
npm run build

# 检查文件权限
sudo chown -R www-data:www-data /home/idim/项目推荐表设计/frontend/dist
```

---

## 📞 技术支持

### 华为云技术支持
- **工单系统**: 华为云控制台 → 服务支持 → 提交工单
- **电话支持**: 400-xxx-xxxx（华为云客服）
- **文档中心**: [华为云帮助中心](https://support.huaweicloud.com/)

### 应用技术支持
- **系统日志**: `/var/log/` 目录下的各种日志文件
- **应用日志**: `sudo journalctl -u idim-backend`
- **Nginx日志**: `/var/log/nginx/`

---

## 🎯 部署后的优化建议

### 性能优化
1. **启用Gzip压缩**（Nginx配置）
2. **配置CDN**（华为云CDN服务）
3. **数据库优化**（索引、查询优化）
4. **缓存策略**（Redis缓存）

### 安全加固
1. **定期更新系统**
2. **配置fail2ban**（防暴力破解）
3. **定期备份数据**
4. **监控系统资源**

### 扩展性考虑
1. **负载均衡**（多台服务器）
2. **数据库分离**（独立数据库服务器）
3. **容器化部署**（Docker）
4. **自动化部署**（CI/CD）

---

*部署完成后，您的IDIM项目管理系统将可以通过互联网访问，支持多用户并发使用！*

**🌟 预祝部署成功！**
